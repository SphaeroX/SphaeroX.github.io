<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sun Tracker</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        video {
            display: block;
            width: 80%;
            max-width: 600px;
        }
        #instructions {
            margin-top: 20px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <video id="video" autoplay></video>
    <div id="instructions">Richte dein Handy zur Sonne aus...</div>
    
    <script>
        const video = document.getElementById('video');
        const instructions = document.getElementById('instructions');

        // Access the webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing webcam: ", err);
                instructions.textContent = "Webcam-Zugriff fehlgeschlagen.";
            });

        let latitude, longitude;
        let orientation = { alpha: 0, beta: 0, gamma: 0 };

        // Get GPS location
        navigator.geolocation.getCurrentPosition(position => {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
            calculateSunPosition();
        }, err => {
            console.error("Error getting location: ", err);
            instructions.textContent = "GPS-Zugriff fehlgeschlagen.";
        });

        // Get device orientation
        window.addEventListener('deviceorientation', event => {
            orientation.alpha = event.alpha;
            orientation.beta = event.beta;
            orientation.gamma = event.gamma;
            calculateSunPosition();
        });

        function calculateSunPosition() {
            if (latitude === undefined || longitude === undefined) return;
            
            const now = new Date();
            const hours = now.getUTCHours();
            const minutes = now.getUTCMinutes();
            const seconds = now.getUTCSeconds();
            const dayOfYear = Math.floor((now - new Date(now.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);

            // Calculate sun position
            const declination = 23.45 * Math.sin(2 * Math.PI / 365 * (dayOfYear - 81));
            const timeCorrection = 4 * (longitude - 15 * Math.floor(longitude / 15)) + 60 * (hours - 12) + minutes + seconds / 60;
            const solarHourAngle = 15 * (timeCorrection / 60);
            const solarAltitude = Math.asin(Math.sin(declination * Math.PI / 180) * Math.sin(latitude * Math.PI / 180) + Math.cos(declination * Math.PI / 180) * Math.cos(latitude * Math.PI / 180) * Math.cos(solarHourAngle * Math.PI / 180)) * 180 / Math.PI;
            const solarAzimuth = Math.acos((Math.sin(declination * Math.PI / 180) - Math.sin(solarAltitude * Math.PI / 180) * Math.sin(latitude * Math.PI / 180)) / (Math.cos(solarAltitude * Math.PI / 180) * Math.cos(latitude * Math.PI / 180))) * 180 / Math.PI;
            
            const deviceAzimuth = orientation.alpha;
            const deviceAltitude = orientation.beta - 90;

            let direction = '';

            if (Math.abs(solarAzimuth - deviceAzimuth) > 10) {
                direction += solarAzimuth > deviceAzimuth ? 'rechts' : 'links';
            }

            if (Math.abs(solarAltitude - deviceAltitude) > 10) {
                direction += solarAltitude > deviceAltitude ? ' hoch' : ' runter';
            }

            instructions.textContent = direction === '' ? 'Perfekt ausgerichtet!' : `Weiter nach ${direction.trim()}.`;
        }
    </script>
</body>
</html>
